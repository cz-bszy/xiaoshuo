---
name: consistency-checker-mega
description: "è¶…é•¿ç¯‡å°è¯´å¢å¼ºç‰ˆä¸€è‡´æ€§æ£€æŸ¥æ¨¡å—ã€‚ç®¡ç†400ä¸‡å­—çº§åˆ«çš„ä¸–ç•Œä¹¦ï¼ˆäººç‰©ã€åœ°ç‚¹ã€ç‰©å“ã€äº‹ä»¶ï¼‰ï¼Œæ£€æµ‹çŸ›ç›¾ï¼Œè¿½è¸ªå…ƒç´ å‡ºåœºã€‚å½“ç”¨æˆ·æåˆ°ä¸€è‡´æ€§ã€çŸ›ç›¾ã€ä¸–ç•Œä¹¦ã€è®¾å®šæ—¶è‡ªåŠ¨æ¿€æ´»ã€‚"
allowed-tools: Read, Edit, Grep
---

# å¢å¼ºç‰ˆä¸€è‡´æ€§æ£€æŸ¥

## æ ¸å¿ƒåŠŸèƒ½

ä¸“ä¸º100ä¸‡å­—ä»¥ä¸Šè¶…é•¿ç¯‡è®¾è®¡çš„ä¸€è‡´æ€§æ£€æŸ¥ç³»ç»Ÿï¼Œç®¡ç†å¤æ‚çš„ä¸–ç•Œä¹¦å¹¶æŒç»­æ£€æµ‹çŸ›ç›¾ã€‚

---

## ä¸–ç•Œä¹¦ç»“æ„

### characters.jsonï¼ˆäººç‰©åº“ï¼‰

```json
{
  "characters": {
    "main_001": {
      "id": "main_001",
      "name": "ä¸»è§’å",
      "aliases": ["é¢†ä¸»", "å¤§äºº"],
      "type": "main",
      "first_appearance": "v01c001",
      "last_appearance": "v02c175",
      
      "basic": {
        "gender": "male",
        "age_start": 18,
        "age_current": 20,
        "appearance": {
          "height": "ä¸­ç­‰åé«˜",
          "hair": "é»‘å‘",
          "eyes": "æ·±æ£•è‰²",
          "features": ["å·¦æ‰‹æœ‰ä¼¤ç–¤"]
        }
      },
      
      "personality": {
        "core_traits": ["åšéŸ§", "åŠ¡å®", "å–„äºè§„åˆ’"],
        "fears": ["å¤±å»é¢†åœ°"],
        "desires": ["å»ºè®¾ç¹è£é¢†åœ°"],
        "speech_pattern": "ç®€æ´ã€ç›´æ¥"
      },
      
      "abilities": {
        "skills": ["å†œä¸šçŸ¥è¯†", "åŸºç¡€å‰‘æœ¯", "ç®¡ç†èƒ½åŠ›"],
        "magic": null,
        "limitations": ["ä¸ä¼šé«˜ç­‰é­”æ³•", "ä½“åŠ›æ™®é€š"]
      },
      
      "relationships": {
        "rel_001": {
          "target": "side_003",
          "type": "subordinate",
          "description": "å¿ è¯šçš„è€ç®¡å®¶",
          "since": "v01c002"
        }
      },
      
      "arc": {
        "current_stage": "å‘å±•æœŸ",
        "growth_points": [
          {"chapter": "v01c050", "change": "å­¦ä¼šè€å¿ƒç­‰å¾…"}
        ]
      },
      
      "appearances": [
        {"chapter": "v01c001", "role": "POV"},
        {"chapter": "v01c002", "role": "POV"}
      ]
    }
  }
}
```

### locations.jsonï¼ˆåœ°ç‚¹åº“ï¼‰

```json
{
  "locations": {
    "loc_001": {
      "id": "loc_001",
      "name": "ä¸»è§’é¢†åœ°",
      "aliases": ["è¾¹å¢ƒé¢†åœ°", "XXé¢†"],
      "first_appearance": "v01c001",
      
      "geography": {
        "type": "é¢†åœ°",
        "size": "çº¦50å¹³æ–¹å…¬é‡Œ",
        "terrain": ["å¹³åŸ", "ä¸€æ¡æ²³æµ", "å°‘é‡æ£®æ—"],
        "climate": "æ¸©å¸¦",
        "neighbors": ["ä¸œä¸´XXé¢†", "è¥¿æ¥è’é‡"]
      },
      
      "features": {
        "buildings": [
          {"name": "é¢†ä¸»åºœ", "status": "ç ´æ—§", "since": "v01c001"},
          {"name": "è°·ä»“", "status": "æ–°å»º", "since": "v01c030"}
        ],
        "resources": ["å¯è€•åœ°", "æ²³æ°´", "æœ¨æ"]
      },
      
      "population": {
        "initial": 50,
        "current": 200,
        "history": [
          {"chapter": "v01c001", "count": 50},
          {"chapter": "v01c100", "count": 200}
        ]
      },
      
      "events": [
        {"chapter": "v01c001", "event": "ä¸»è§’æŠµè¾¾"},
        {"chapter": "v01c080", "event": "å‡»é€€ç›—åŒª"}
      ]
    }
  }
}
```

### items.jsonï¼ˆç‰©å“åº“ï¼‰

```json
{
  "items": {
    "item_001": {
      "id": "item_001",
      "name": "ä¼ å®¶å®å‰‘",
      "type": "weapon",
      "first_appearance": "v01c010",
      
      "description": {
        "appearance": "æ™®é€šé“å‰‘ï¼Œå‰‘æŸ„æœ‰å®¶æ—çº¹ç« ",
        "properties": ["æ™®é€šæ­¦å™¨", "æœ‰çºªå¿µæ„ä¹‰"],
        "magic": null
      },
      
      "ownership": [
        {"owner": "main_001", "since": "v01c010", "status": "current"}
      ],
      
      "location_history": [
        {"chapter": "v01c010", "location": "é¢†ä¸»åºœ"},
        {"chapter": "v01c080", "location": "ä¸»è§’éšèº«"}
      ]
    }
  }
}
```

### events.jsonï¼ˆäº‹ä»¶åº“ï¼‰

```json
{
  "events": {
    "evt_001": {
      "id": "evt_001",
      "name": "ç¬¬ä¸€æ¬¡æ”¶è·",
      "type": "milestone",
      "chapter": "v01c050",
      
      "description": "é¢†åœ°ç¬¬ä¸€æ¬¡æˆåŠŸæ”¶è·å°éº¦",
      
      "participants": ["main_001", "side_003", "villagers"],
      "location": "loc_001",
      
      "consequences": [
        "ç²®é£Ÿå‚¨å¤‡å¢åŠ ",
        "æ‘æ°‘ä¿¡å¿ƒæå‡"
      ],
      
      "foreshadowing": [
        {"planted": "v01c020", "content": "æ’­ç§åœºæ™¯"}
      ]
    }
  }
}
```

### rules.jsonï¼ˆè§„åˆ™åº“ï¼‰

```json
{
  "rules": {
    "magic_system": {
      "name": "ä½é­”ä½“ç³»",
      "description": "é­”æ³•ç¨€å°‘ä¸”æ•ˆæœæœ‰é™",
      "rules": [
        "æ™®é€šäººæ— æ³•ä½¿ç”¨é­”æ³•",
        "é­”æ³•ç‰©å“æå…¶ç¨€æœ‰",
        "é­”æ³•æ•ˆæœä¸»è¦æ˜¯è¾…åŠ©æ€§çš„",
        "æ²¡æœ‰æ”»å‡»æ€§çš„å¼ºåŠ›é­”æ³•"
      ],
      "exceptions": [],
      "violations": []
    },
    
    "social_system": {
      "name": "å°å»ºé¢†åœ°åˆ¶",
      "rules": [
        "é¢†ä¸»æ‹¥æœ‰é¢†åœ°ç®¡è¾–æƒ",
        "å†œæ°‘ä¾é™„äºåœŸåœ°",
        "è´µæ—ç­‰çº§åˆ†æ˜"
      ]
    },
    
    "technology_level": {
      "name": "ä¸­ä¸–çºªæ°´å¹³",
      "allowed": ["å†œä¸šå·¥å…·", "å†·å…µå™¨", "é©¬è½¦"],
      "forbidden": ["ç«å™¨", "è’¸æ±½æœº", "ç”µåŠ›"]
    }
  }
}
```

---

## æ£€æŸ¥ç±»å‹

### 1. å®æ—¶æ£€æŸ¥ï¼ˆæ¯ç« å†™ä½œåï¼‰

```
å¿«é€Ÿæ£€æŸ¥é¡¹ï¼š
â”œâ”€â”€ äººç‰©ç§°å‘¼æ˜¯å¦æ­£ç¡®
â”œâ”€â”€ äººç‰©æ˜¯å¦åœ¨åœºæ™¯ä¸­ï¼ˆä¸èƒ½éš”ç©ºå¯¹è¯ï¼‰
â”œâ”€â”€ å…³é”®ç‰©å“æ˜¯å¦éšèº«
â”œâ”€â”€ æ—¶é—´æ˜¯å¦è¿ç»­
â””â”€â”€ åŸºæœ¬è®¾å®šæ˜¯å¦è¿å

æ£€æŸ¥æ—¶é—´ï¼š< 5ç§’
è‡ªåŠ¨ä¿®æ­£ï¼šæ”¯æŒ
```

### 2. æ·±åº¦æ£€æŸ¥ï¼ˆæ¯5ç« ï¼‰

```
è¯¦ç»†æ£€æŸ¥é¡¹ï¼š
â”œâ”€â”€ äººç‰©æ€§æ ¼ä¸€è‡´æ€§
â”‚   â””â”€â”€ å¯¹æ¯”è¿‘5ç« ä¸å†å²è¡¨ç°
â”œâ”€â”€ èƒ½åŠ›è¾¹ç•Œæ£€æŸ¥
â”‚   â””â”€â”€ æ˜¯å¦è¶…å‡ºè®¾å®šèƒ½åŠ›
â”œâ”€â”€ å…³ç³»å‘å±•åˆç†æ€§
â”‚   â””â”€â”€ å…³ç³»å˜åŒ–æ˜¯å¦æœ‰é“ºå«
â”œâ”€â”€ æ—¶é—´çº¿å®Œæ•´æ€§
â”‚   â””â”€â”€ äº‹ä»¶é¡ºåºæ˜¯å¦çŸ›ç›¾
â””â”€â”€ ä¸–ç•Œè§‚è§„åˆ™éµå®ˆ
    â””â”€â”€ æ˜¯å¦è¿årules.json

æ£€æŸ¥æ—¶é—´ï¼š1-2åˆ†é’Ÿ
éœ€äººå·¥ç¡®è®¤ï¼šæ˜¯
```

### 3. å…¨é¢æ£€æŸ¥ï¼ˆæ¯å·å®Œæˆåï¼‰

```
å…¨é¢æ£€æŸ¥é¡¹ï¼š
â”œâ”€â”€ å®Œæ•´æ—¶é—´çº¿éªŒè¯
â”œâ”€â”€ æ‰€æœ‰äººç‰©å‡ºåœºé¢‘ç‡
â”œâ”€â”€ ä¼ç¬”å›æ”¶çŠ¶æ€
â”œâ”€â”€ ä¸–ç•Œè§‚ä¸€è‡´æ€§
â”œâ”€â”€ æƒ…èŠ‚é€»è¾‘é—­ç¯
â””â”€â”€ æ•°æ®å®Œæ•´æ€§

æ£€æŸ¥æ—¶é—´ï¼š5-10åˆ†é’Ÿ
ç”ŸæˆæŠ¥å‘Šï¼šæ˜¯
```

---

## å…ƒç´ è¿½è¸ª

### å‡ºåœºé¢‘ç‡ç›‘æ§

```
ç›‘æ§è®¾ç½®ï¼ˆå¯é…ç½®ï¼‰ï¼š
â”œâ”€â”€ ä¸»è§’ï¼šæ¯ç« éƒ½åº”å‡ºåœº
â”œâ”€â”€ ä¸»è¦é…è§’ï¼šä¸è¶…è¿‡5ç« ä¸å‡ºåœº
â”œâ”€â”€ æ¬¡è¦é…è§’ï¼šä¸è¶…è¿‡15ç« ä¸å‡ºåœº
â””â”€â”€ é‡è¦ç‰©å“ï¼šä¸è¶…è¿‡20ç« ä¸æåŠ

è­¦å‘Šï¼š
âš ï¸ ä»¥ä¸‹å…ƒç´ å·²ä¹…æœªå‡ºåœºï¼š
â”œâ”€â”€ [side_003] è€ç®¡å®¶ - 12ç« æœªå‡ºåœºï¼ˆé˜ˆå€¼5ï¼‰
â”œâ”€â”€ [item_001] ä¼ å®¶å®å‰‘ - 25ç« æœªæåŠï¼ˆé˜ˆå€¼20ï¼‰
â””â”€â”€ [plot_002] ç¥ç§˜æ¥ä¿¡ - 30ç« æœªè·Ÿè¿›ï¼ˆä¼ç¬”ï¼‰
```

### å…³ç³»å˜åŒ–è¿½è¸ª

```
å…³ç³»å˜åŒ–æ—¥å¿—ï¼š
â”œâ”€â”€ v01c050: main_001 â†’ side_003 (å…³ç³»åŠ æ·±)
â”œâ”€â”€ v01c080: main_001 â†’ enemy_001 (å»ºç«‹æ•Œå¯¹)
â””â”€â”€ v02c010: main_001 â†’ side_007 (æ–°å…³ç³»å»ºç«‹)
```

---

## å‘½ä»¤

### `/mega-worldbook` - ä¸–ç•Œä¹¦ç®¡ç†

```
/mega-worldbook view [type]     æŸ¥çœ‹ä¸–ç•Œä¹¦ï¼ˆcharacters/locations/items/events/rulesï¼‰
/mega-worldbook add [type]      æ·»åŠ æ–°æ¡ç›®
/mega-worldbook update [id]     æ›´æ–°æ¡ç›®
/mega-worldbook search [query]  æœç´¢æ¡ç›®
/mega-worldbook check           è¿è¡Œä¸€è‡´æ€§æ£€æŸ¥
```

### `/mega-consistency` - ä¸€è‡´æ€§æ£€æŸ¥

```
/mega-consistency quick         å¿«é€Ÿæ£€æŸ¥æœ€æ–°ç« èŠ‚
/mega-consistency deep [range]  æ·±åº¦æ£€æŸ¥æŒ‡å®šèŒƒå›´
/mega-consistency full          å…¨é¢æ£€æŸ¥ï¼ˆè€—æ—¶ï¼‰
/mega-consistency report        ç”Ÿæˆæ£€æŸ¥æŠ¥å‘Š
```

---

## çŸ›ç›¾æ£€æµ‹

### è‡ªåŠ¨æ£€æµ‹

```python
def check_contradiction(new_content, worldbook):
    contradictions = []
    
    # æ£€æŸ¥äººç‰©ä¿¡æ¯
    for char_mention in extract_characters(new_content):
        stored = worldbook.characters.get(char_mention.id)
        if stored:
            # æ£€æŸ¥å¤–è²Œ
            if char_mention.appearance != stored.appearance:
                contradictions.append({
                    "type": "character_appearance",
                    "character": char_mention.name,
                    "new": char_mention.appearance,
                    "stored": stored.appearance,
                    "severity": "medium"
                })
            # æ£€æŸ¥èƒ½åŠ›
            # æ£€æŸ¥å…³ç³»
            # ...
    
    return contradictions
```

### çŸ›ç›¾æŠ¥å‘Š

```
ğŸ” ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ£€æŸ¥èŒƒå›´ï¼šç¬¬171-175ç« 
æ£€æŸ¥æ—¶é—´ï¼š2026-01-25 16:00

âŒ å‘ç°çŸ›ç›¾ï¼ˆ1ä¸ªï¼‰
â”œâ”€â”€ [C173] äººç‰©å¤–è²ŒçŸ›ç›¾
â”‚   â”œâ”€â”€ æè¿°ï¼š"è“è‰²çœ¼ç›çš„è€ç®¡å®¶"
â”‚   â”œâ”€â”€ å­˜å‚¨ï¼šçœ¼ç›é¢œè‰²=ç°è‰²ï¼ˆv01c002ï¼‰
â”‚   â””â”€â”€ å»ºè®®ï¼šä¿®æ”¹ä¸º"ç°è‰²çœ¼ç›"

âš ï¸ éœ€è¦å…³æ³¨ï¼ˆ2ä¸ªï¼‰
â”œâ”€â”€ [C172] æ—¶é—´è·³è·ƒè¿‡å¤§
â”‚   â”œâ”€â”€ ä¸Šä¸€ç« ï¼šå¤æœ«
â”‚   â”œâ”€â”€ æœ¬ç« ï¼šæ·±å†¬
â”‚   â””â”€â”€ å»ºè®®ï¼šè¡¥å……è¿‡æ¸¡æå†™
â””â”€â”€ [C175] èƒ½åŠ›è¾¹ç•Œ
    â”œâ”€â”€ æè¿°ï¼šä¸»è§’è½»æ¾ä¸¾èµ·é‡ç‰©
    â”œâ”€â”€ è®¾å®šï¼šä½“åŠ›æ™®é€š
    â””â”€â”€ å»ºè®®ï¼šå¢åŠ å›°éš¾æå†™

âœ… é€šè¿‡æ£€æŸ¥ï¼ˆ3é¡¹ï¼‰
â”œâ”€â”€ äººç‰©å…³ç³»ä¸€è‡´
â”œâ”€â”€ ä¸–ç•Œè§‚è§„åˆ™éµå®ˆ
â””â”€â”€ ç‰©å“è¿½è¸ªæ­£ç¡®

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## è‡ªåŠ¨æ›´æ–°ä¸–ç•Œä¹¦

æ¯ç« å†™ä½œå®Œæˆåè‡ªåŠ¨ï¼š

1. æå–æ–°äººç‰©ä¿¡æ¯ â†’ æ›´æ–°characters.json
2. æå–åœ°ç‚¹å˜åŒ– â†’ æ›´æ–°locations.json
3. æå–é‡è¦ç‰©å“ â†’ æ›´æ–°items.json
4. è®°å½•é‡å¤§äº‹ä»¶ â†’ æ›´æ–°events.json
5. æ›´æ–°å‡ºåœºè®°å½•

---

## ä¸å…¶ä»–æ¨¡å—åä½œ

### æä¾›ç»™ mega-novel-orchestrator

- å†™ä½œä¸Šä¸‹æ–‡ï¼ˆç›¸å…³äººç‰©/åœ°ç‚¹ä¿¡æ¯ï¼‰
- å®æ—¶ä¸€è‡´æ€§æ£€æŸ¥ç»“æœ

### æä¾›ç»™ quality-monitor

- ä¸€è‡´æ€§è¯„åˆ†
- çŸ›ç›¾åˆ—è¡¨

### æ¥è‡ª outline-manager

- è®¡åˆ’ç™»åœºçš„äººç‰©
- é¢„å®šäº‹ä»¶

---

**ç‰ˆæœ¬**ï¼šv1.0
**æ›´æ–°**ï¼š2026-01-25
**ä¾èµ–**ï¼šmega-novel-orchestrator
